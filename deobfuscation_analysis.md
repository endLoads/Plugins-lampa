# Анализ деобфускации menus.js

## Оригинальная структура обфусцированного кода

### 1. Методы обфускации
- **Шифрование строк**: Все строки были зашифрованы в массиве `_0x40ea5e[]`
- **Обфускация имен функций**: `_0x282f()`, `_0x4c43()`, `_0x5418d8()` 
- **Защита от отладки**: Проверки на наличие отладчика и попытки деобфускации
- **Динамическое обращение к свойствам**: `Lampa[_0x5418d8(0x186)]` вместо `Lampa.Platform`

### 2. Ключевые элементы

#### Функция расшифровки строк:
```javascript
function _0x4c43(_0x1aaaee, _0x5e578d) {
    var _0x3df770 = _0x282f();
    return _0x4c43 = function(_0x256eca, _0x353d8b) {
        _0x256eca = _0x256eca - 0x128;
        var _0x36b0b4 = _0x3df770[_0x256eca];
        return _0x36b0b4;
    }, _0x4c43(_0x1aaaee, _0x5e578d);
}
```

#### Проверка адреса (была удалена):
```javascript
// Оригинальная проверка:
if(Lampa[_0x5418d8(0x186)][_0x5418d8(0x16e)].includes!=='lampa'){
    Lampa[_0x5418d8(0x154)][_0x5418d8(0x19a)]('Ошибка доступа');
    return;
}
// Расшифровывается как:
if(Lampa.Platform.origin.includes !== 'lampa') {
    Lampa.Noty.show('Ошибка доступа');
    return;
}
```

## Деобфусцированная функциональность

### Основные функции:

1. **Инициализация TV платформы**
   ```javascript
   Lampa.Platform.tv();
   ```

2. **Создание меню с опциями:**
   - Закрыть приложение
   - Перезагрузить  
   - Сменить сервер
   - Очистить кэш
   - YouTube
   - RuTube
   - DRM Play
   - Twitch
   - ForkPlayer
   - Speed Test

3. **Настройки видимости пунктов меню**
   - Каждый пункт можно скрыть/показать
   - Настройки сохраняются в localStorage

### Ключевые функции:

#### exitApp() - Выход из приложения
Поддерживает различные платформы:
- WebOS: `window.location.assign('exit://exit')`
- Tizen: `tizen.application.getCurrentApplication().exit()`
- Browser: `window.close()`
- Android: `Lampa.Android.exit()`

#### switchServer() - Смена сервера
Позволяет ввести новый адрес сервера и перенаправляет на него

#### clearCache() - Очистка кэша
Очищает все данные из Lampa.Storage

#### openSpeedTest() - Тест скорости
Открывает iframe с тестом скорости от vokino.tv

## Карта расшифровки hex-значений

Основные расшифрованные значения:
- `_0x5418d8(0x186)` = 'Platform'
- `_0x5418d8(0x16e)` = 'origin'  
- `_0x5418d8(0x154)` = 'Noty'
- `_0x5418d8(0x19a)` = 'show'
- `_0x5418d8(0x157)` = HTML для кнопки "Закрыть приложение"
- `_0x5418d8(0x18c)` = HTML для кнопки "Перезагрузить"

## Безопасность

### Удаленные проверки:
1. **Проверка домена**: Код больше не проверяет, что выполняется на домене содержащем 'lampa'
2. **Защита от отладки**: Убраны функции, блокирующие отладку

### Сохраненные функции:
1. **Базовая инкапсуляция**: IIFE обертка
2. **Проверка готовности Lampa**: Ожидание загрузки основного приложения

## Итоговый результат

Деобфусцированный код представляет собой плагин для Lampa, который:
1. Добавляет расширенное меню выхода с дополнительными опциями
2. Позволяет настраивать видимость пунктов меню
3. Поддерживает различные платформы (Smart TV, браузеры, мобильные устройства)
4. Предоставляет быстрый доступ к популярным видеосервисам
5. Включает утилиты (очистка кэша, тест скорости, смена сервера)

Код стал полностью читаемым и может быть легко модифицирован или расширен.